!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t){t.exports={tables:[{name:"school",columns:[{name:"id",pk:!0,type:"int"},{name:"cpacity",required:!0,type:"int"},{name:"name",required:!0,type:"string"},{name:"address",required:!0,type:"string"}]},{name:"class",columns:[{name:"id",pk:!0,type:"int"},{name:"grade",required:!0,type:"int"},{name:"school_id",required:!0,fk:{table:"school",column:"id"}}]},{name:"student",columns:[{name:"id",pk:!0,type:"int"},{name:"firstname",required:!0,type:"string"},{name:"lastname",required:!0,type:"string"},{name:"age",required:!0,type:"int"},{name:"class_id",fk:{table:"class",column:"id"},required:!0},{name:"friend",required:!0,fk:{table:"student",column:"id"}},{name:"friend1",required:!0,fk:{table:"student",column:"id"}},{name:"friend2",required:!0,fk:{table:"student",column:"id"}},{name:"friend3",required:!0,fk:{table:"student",column:"id"}}]}]}},function(t,e,i){"use strict";i.r(e);i(2);var n=i(0);document.querySelector("db-designer").schema=n},function(t,e){!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){(t.exports=i(2)(!1)).push([t.i,":host {\n  display: block;\n  overflow: hidden;\n}\n\n#designer-container {\n  height: 100%;\n  position: relative;\n\n  background-color: #ccc;\n  overflow: auto;\n\n  -moz-user-select: none !important;\n  -o-user-select: none !important;\n  -khtml-user-select: none !important;\n  -webkit-user-select: none !important;\n  -ms-user-select: none !important;\n  user-select: none !important;\n}\n\n#designer-container #minimap {\n  border-style: solid;\n  border-width: 1px;\n  background-color: #e3ebed;\n  margin-bottom: 5px;\n  display: block;\n}\n\n#designer-container #minimap #viewpoint {\n  fill: none;\n  stroke-width: 10;\n  stroke: black;\n}\n\n#designer-container #minimap-container {\n  left: 10px;\n  bottom: 18px;\n  width: 64px;\n  position: absolute;\n}\n\n#designer-container #minimap-container #minimap .mini_table {\n  fill: lightcyan;\n  stroke-width: 10;\n  stroke: black;\n  float: left;\n}\n\n#designer-container #minimap-container #btn-container button{\n  width: 30px;\n  height: 30px;\n  margin-bottom: 5px;\n  padding: 1px;\n  font-size: large;\n}\n\n#designer-container .svg-container {\n  overflow: auto;\n  width: 100%;\n  height: 100%;\n}\n\n#designer {\n  user-select: none;\n  cursor: default;\n  display: block;\n  background-color: #e3ebed;\n  font: normal 10px Verdana, Arial, sans-serif;\n}\n\n#designer.pan {\n  cursor: grabbing;\n}\n\n.tableGroup {\n  stroke: #707070;\n}\n\n.table {\n  background-color: white;\n  min-width: 100px;\n  border-collapse: collapse;\n\n  border: 1px solid #bbb;\n}\n\n.table.move {\n  cursor: move;\n}\n\n.table tr {\n  border-bottom: 1px solid #bbb;\n}\n\n.table tr th {\n  font-size: 1.2em;\n  padding: 5px;\n  background-color: lightcyan;\n}\n\n.table td {\n  padding: 5px;\n  padding-left: 10px;\n  padding-right: 10px;\n}\n\npath {\n  stroke-width: 1;\n  stroke: #666;\n  fill: none;\n}\n\n.pathHover {\n  stroke-width: 2;\n  stroke: black;\n}\n\n.fromRelation {\n  background-color: lightgreen;\n}\n\n.toRelation {\n  background-color: lightcoral;\n}\n\n.highlight {\n  stroke-width: 12;\n  stroke: transparent;\n}\n",""])},function(t,e){t.exports='<div id="designer-container">\n  <div class="svg-container">\n    <svg id="designer" version="2" baseProfile="full" xmlns="http://www.w3.org/2000/svg">\n    </svg>\n  </div>\n  <div id="minimap-container">\n    <svg id="minimap" version="2" baseProfile="full" xmlns="http://www.w3.org/2000/svg">\n      <rect id="viewpoint"></rect>\n    </svg>\n    <div id="btn-container">\n      <button id="btn-zoom-in">+</button>\n      <button id="btn-zoom-out">-</button>\n    </div>\n  </div>\n</div>\n'},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var o=function(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}(n),s=n.sources.map(function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"});return[i].concat(s).concat([o]).join("\n")}return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i}).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},o=0;o<this.length;o++){var s=this[o][0];"number"==typeof s&&(n[s]=!0)}for(o=0;o<t.length;o++){var a=t[o];"number"==typeof a[0]&&n[a[0]]||(i&&!a[2]?a[2]=i:i&&(a[2]="("+a[2]+") and ("+i+")"),e.push(a))}},e}},function(t,e,i){"use strict";function n(t){return Math.round(1e3*t)/1e3}function o(t,e,i,o){const s=function(t,e,i,o){const s=t.x-e.x,a=i.x-o.x;if(0===s&&0===a)return null;if(0===s){const e=(i.y-o.y)/a,n=i.y-e*i.x;return{y:e*t.x+n,x:t.x}}const h=(t.y-e.y)/s,r=t.y-h*t.x;if(0===a){return{y:h*i.x+r,x:i.x}}const l=(i.y-o.y)/a;if(h===l)return null;const m=(r-(i.y-l*i.x))/(l-h),c=h*m+r;return{x:n(m),y:n(c)}}(t,e,i,o);return s&&s.x<=Math.max(t.x,e.x)&&s.x>=Math.min(t.x,e.x)&&s.x<=Math.max(i.x,o.x)&&s.x>=Math.min(i.x,o.x)&&s.y<=Math.max(t.y,e.y)&&s.y>=Math.min(t.y,e.y)&&s.y<=Math.max(i.y,o.y)&&s.y>=Math.min(i.y,o.y)?s:null}i.r(e);var s={PATH_LEFT:"left",PATH_RIGHT:"right",PATH_TOP:"top",PATH_BOTTOM:"bottom",DESIGNER_PAN_HEIGHT:3e3,DESIGNER_PAN_WIDTH:3e3,nsSvg:"http://www.w3.org/2000/svg",nsHtml:"http://www.w3.org/1999/xhtml"};const a=9,h=4,r=7,l=5,m=40;class c{constructor({fromColumn:t,fromPathCount:e,fromPathIndex:i,fromTable:n,fromTablePathSide:o,toColumn:s,toPathCount:a,toPathIndex:h,toTable:r,toTablePathSide:l}){this.fromColumn=t,this.fromPathCount=e,this.fromPathIndex=i,this.fromTable=n,this.toColumn=s,this.toPathCount=a,this.toPathIndex=h,this.toTable=r}update(){this._getTableRelationSide()}_getPosOnLine(t,e,i){return(t+1)*(i/(e+1))}_getLeftSidePathCord(t,e,i){const n=t.left.p2.y-t.left.p1.y,o=this._getPosOnLine(e,i,n);return{y:t.left.p1.y+o,x:t.left.p1.x}}_getRightSidePathCord(t,e,i){const n=t.right.p2.y-t.right.p1.y,o=this._getPosOnLine(e,i,n);return{y:t.right.p1.y+o,x:t.right.p1.x}}_getTopSidePathCord(t,e,i){const n=t.top.p2.x-t.top.p1.x,o=this._getPosOnLine(e,i,n);return{y:t.top.p1.y,x:t.top.p1.x+o}}_getBottomSidePathCord(t,e,i){const n=t.bottom.p2.x-t.bottom.p1.x,o=this._getPosOnLine(e,i,n);return{y:t.bottom.p1.y,x:t.bottom.p1.x+o}}_get2LinePathFlatTop(t,e){let i,n=`M ${e.x} ${e.y} `,o=`M ${e.x} ${e.y} `;if(t.y>e.y){i=`M ${t.x-l} ${t.y-r}\n                    h ${2*l}`,t.x>e.x?(n+=`l ${a} `,o+=`l ${a} `):(n+=`l ${-a} `,o+=`l ${-a} `),n+=h,o+=-h;const s=t;t=e,e=s}else n+=`l ${h} ${-a}`,o+=`l ${-h} ${-a}`,i=t.x>e.x?`M ${t.x-r} `:`M ${t.x+r} `,i+=`${t.y-l} v ${2*l}`;const s=`M ${t.x} ${t.y} H ${e.x} V ${e.y}`,m=`${i} ${s} ${n} ${o}`;return{path:this._createPath(m),highlight:this._createHighlightTrigger(s)}}_get2LinePathFlatBottom(t,e){let i,n=`M ${e.x} ${e.y} `,o=`M ${e.x} ${e.y} `;if(t.y>e.y){n+=`l ${h} ${a}`,o+=`l ${-h} ${a}`,i=t.x>e.x?`M ${t.x-r} `:`M ${t.x+r} `,i+=`${t.y-l} `,i+=`v ${2*l}`;const s=t;t=e,e=s}else i=`M ${t.x-l} ${t.y+r} h ${2*l}`,t.x>e.x?(n+=`l ${a} `,o+=`l ${a} `):(n+=`l ${-a} `,o+=`l ${-a} `),n+=h,o+=-h;const s=`M ${t.x} ${t.y} V ${e.y} H ${e.x}`,m=`${i} ${s} ${n} ${o}`;return{path:this._createPath(m),highlight:this._createHighlightTrigger(s)}}_get3LinePathHoriz(t,e){let i,n=`M ${e.x} ${e.y} `,o=`M ${e.x} ${e.y} `;if(t.x>e.x){n+=`l ${a} `,o+=`l ${a} `,i=`M ${t.x-r} ${t.y-l} v ${2*l}`;const s=t;t=e,e=s}else n+=`l ${-a} `,o+=`l ${-a} `,i=`M ${t.x+r} ${t.y-l} v ${2*l}`;n+=h,o+=-h;const s=t.x+(e.x-t.x)/2,m=`M ${t.x} ${t.y} H ${s} V ${e.y} H ${e.x}`,c=`${i} ${m} ${n} ${o}`;return{path:this._createPath(c),highlight:this._createHighlightTrigger(m)}}_get3LinePathVert(t,e){let i=`M ${e.x} ${e.y} l ${h} `,n=`M ${e.x} ${e.y} l ${-h} `,o=`M ${t.x-l} `;if(t.y>e.y?(i+=a,n+=a,o+=`${t.y-r} h ${2*l}`):(i+=-a,n+=-a,o+=`${t.y+r} h ${2*l}`),t.x>e.x){const i=t;t=e,e=i}const s=t.y+(e.y-t.y)/2,m=`M ${t.x} ${t.y} V ${s} H ${e.x} V ${e.y}`,c=`${o} ${m} ${i} ${n}`;return{path:this._createPath(c),highlight:this._createHighlightTrigger(m)}}removeHoverEffect(){this._onMouseLeave()}_onMouseEnter(){this.pathElem.classList.add("pathHover"),this.fromTable.highlightFrom(this.fromColumn),this.toTable.highlightTo(this.toColumn)}_onMouseLeave(){this.pathElem&&(this.pathElem.classList.remove("pathHover"),this.fromTable.removeHighlightFrom(this.fromColumn),this.toTable.removeHighlightTo(this.toColumn))}_setElems(t,e){this.pathElem=t,this.highlightTrigger=e,e.onmouseenter=this._onMouseEnter.bind(this),e.onmouseleave=this._onMouseLeave.bind(this)}_createHighlightTrigger(t){const e=document.createElementNS(s.nsSvg,"path");return e.setAttributeNS(null,"d",t),e.classList.add("highlight"),e}_createPath(t){const e=document.createElementNS(s.nsSvg,"path");return e.setAttributeNS(null,"d",t),e}render(){const t=this.fromTable.getSides(),e=this.toTable.getSides();switch(this.fromTablePathSide){case s.PATH_LEFT:{const i=this._getLeftSidePathCord(t,this.fromPathIndex,this.fromPathCount);switch(this.toTablePathSide){case s.PATH_LEFT:{const t=this._getLeftSidePathCord(e,this.toPathIndex,this.toPathCount),n=`M ${i.x-r} ${i.y-l} v ${2*l}`,o=`M ${i.x} ${i.y} h ${-m}\n                                V ${t.y}\n                                h ${m}`,s=n+o+`M ${t.x} ${t.y} l ${-a} ${-h}\n                                M ${t.x} ${t.y} l ${-a} ${h}`,c=this._createPath(s),d=this._createHighlightTrigger(o);this._setElems(c,d)}break;case s.PATH_RIGHT:{const t=this._getRightSidePathCord(e,this.toPathIndex,this.toPathCount),n=this._get3LinePathHoriz(i,t);this._setElems(n.path,n.highlight)}break;case s.PATH_TOP:{const t=this._getTopSidePathCord(e,this.toPathIndex,this.toPathCount),n=this._get2LinePathFlatTop(i,t);this._setElems(n.path,n.highlight)}break;case s.PATH_BOTTOM:{const t=this._getBottomSidePathCord(e,this.toPathIndex,this.toPathCount),n=this._get2LinePathFlatBottom(i,t);this._setElems(n.path,n.highlight)}}}break;case s.PATH_RIGHT:{const i=this._getRightSidePathCord(t,this.fromPathIndex,this.fromPathCount);switch(this.toTablePathSide){case s.PATH_LEFT:{const t=this._getLeftSidePathCord(e,this.toPathIndex,this.toPathCount),n=this._get3LinePathHoriz(i,t);this._setElems(n.path,n.highlight)}break;case s.PATH_RIGHT:{const t=this._getRightSidePathCord(e,this.toPathIndex,this.toPathCount),n=`M ${i.x+r} ${i.y-l} v ${2*l}`,o=`M ${i.x} ${i.y} h ${m}\n                                V ${t.y}\n                                h ${-m}`,s=n+o+`M ${t.x} ${t.y} l ${a} ${-h}\n                                M ${t.x} ${t.y} l ${a} ${h}`,c=this._createPath(s),d=this._createHighlightTrigger(o);this._setElems(c,d)}break;case s.PATH_TOP:{const t=this._getTopSidePathCord(e,this.toPathIndex,this.toPathCount),n=this._get2LinePathFlatTop(i,t);this._setElems(n.path,n.highlight)}break;case s.PATH_BOTTOM:{const t=this._getBottomSidePathCord(e,this.toPathIndex,this.toPathCount),n=this._get2LinePathFlatBottom(i,t);this._setElems(n.path,n.highlight)}}}break;case s.PATH_TOP:{const i=this._getTopSidePathCord(t,this.fromPathIndex,this.fromPathCount);switch(this.toTablePathSide){case s.PATH_LEFT:{const t=this._getLeftSidePathCord(e,this.toPathIndex,this.toPathCount),n=this._get2LinePathFlatTop(i,t);this._setElems(n.path,n.highlight)}break;case s.PATH_RIGHT:{const t=this._getRightSidePathCord(e,this.toPathIndex,this.toPathCount),n=this._get2LinePathFlatTop(i,t);this._setElems(n.path,n.highlight)}break;case s.PATH_TOP:{const t=this._getTopSidePathCord(e,this.toPathIndex,this.toPathCount),n=`M ${i.x-l} ${i.y-r} h ${2*l}`,o=`M ${i.x} ${i.y} v ${-m}\n                                H ${t.x}\n                                v ${m}`,s=n+o+`M ${t.x} ${t.y} l ${-h} ${-a}\n                                M ${t.x} ${t.y} l ${h} ${-a}`,c=this._createPath(s),d=this._createHighlightTrigger(o);this._setElems(c,d)}break;case s.PATH_BOTTOM:{const t=this._getBottomSidePathCord(e,this.toPathIndex,this.toPathCount),n=this._get3LinePathVert(i,t);this._setElems(n.path,n.highlight)}}}break;case s.PATH_BOTTOM:{const i=this._getBottomSidePathCord(t,this.fromPathIndex,this.fromPathCount);switch(this.toTablePathSide){case s.PATH_LEFT:{const t=this._getLeftSidePathCord(e,this.toPathIndex,this.toPathCount),n=this._get2LinePathFlatBottom(i,t);this._setElems(n.path,n.highlight)}break;case s.PATH_RIGHT:{const t=this._getRightSidePathCord(e,this.toPathIndex,this.toPathCount),n=this._get2LinePathFlatBottom(i,t);this._setElems(n.path,n.highlight)}break;case s.PATH_TOP:{const t=this._getTopSidePathCord(e,this.toPathIndex,this.toPathCount),n=this._get3LinePathVert(i,t);this._setElems(n.path,n.highlight)}break;case s.PATH_BOTTOM:{const t=this._getBottomSidePathCord(e,this.toPathIndex,this.toPathCount),n=`M ${i.x-l} ${i.y+r} h ${2*l}`,o=`M ${i.x} ${i.y} v ${m}\n                                H ${t.x}\n                                v ${-m}`,s=n+o+`M ${t.x} ${t.y} l ${-h} ${a}\n                                M ${t.x} ${t.y} l ${h} ${a}`,c=this._createPath(s),d=this._createHighlightTrigger(o);this._setElems(c,d)}}}}return this.pathElem?[this.pathElem,this.highlightTrigger]:[]}sameTableRelation(){return this.fromTable===this.toTable}calcPathTableSides(){if(this.fromTable===this.toTable)return this;const t=this.fromTable.getCenter(),e=this.toTable.getCenter(),i=this.fromTable.getSides(),n=o(t,e,i.right.p1,i.right.p2);n&&(this.fromIntersectPoint=n,this.fromTablePathSide=s.PATH_RIGHT);const a=o(t,e,i.left.p1,i.left.p2);a&&(this.fromIntersectPoint=a,this.fromTablePathSide=s.PATH_LEFT);const h=o(t,e,i.top.p1,i.top.p2);h&&(this.fromIntersectPoint=h,this.fromTablePathSide=s.PATH_TOP);const r=o(t,e,i.bottom.p1,i.bottom.p2);r&&(this.fromIntersectPoint=r,this.fromTablePathSide=s.PATH_BOTTOM);const l=this.toTable.getSides(),m=o(t,e,l.right.p1,l.right.p2);m&&(this.toIntersectPoint=m,this.toTablePathSide=s.PATH_RIGHT);const c=o(t,e,l.left.p1,l.left.p2);c&&(this.toIntersectPoint=c,this.toTablePathSide=s.PATH_LEFT);const d=o(t,e,l.top.p1,l.top.p2);d&&(this.toIntersectPoint=d,this.toTablePathSide=s.PATH_TOP);const _=o(t,e,l.bottom.p1,l.bottom.p2);_&&(this.toIntersectPoint=_,this.toTablePathSide=s.PATH_BOTTOM)}getElems(){return this.pathElem?[this.pathElem,this.highlightTrigger]:[]}static ySort(t,e){t.sort((t,i)=>null==t.fromIntersectPoint||null==i.fromIntersectPoint?-1:t.fromTable===e?i.fromTable===e?t.fromIntersectPoint.y-i.fromIntersectPoint.y:t.fromIntersectPoint.y-i.toIntersectPoint.y:i.fromTable===e?t.toIntersectPoint.y-i.fromIntersectPoint.y:t.toIntersectPoint.y-i.toIntersectPoint.y)}static xSort(t,e){t.sort((t,i)=>null==t.fromIntersectPoint||null==i.fromIntersectPoint?-1:t.fromTable===e?i.fromTable===e?t.fromIntersectPoint.x-i.fromIntersectPoint.x:t.fromIntersectPoint.x-i.toIntersectPoint.x:i.fromTable===e?t.toIntersectPoint.x-i.fromIntersectPoint.x:t.toIntersectPoint.x-i.toIntersectPoint.x)}}class d{constructor({name:t,columns:e=[],pos:i={x:0,y:0}}){this.columns=e,this._name=t,this._pos=i}get pos(){return this._pos}get name(){return this._name}_moveToTop(){const t=this._elem.parentNode;Array.from(t.children).reverse().forEach(e=>{e!==this._elem&&t.prepend(e)})}_clickEvents(){this._elem.addEventListener("dblclick",()=>{this._designer.tableDblClick(d.tableDataCreator(this))}),this._elem.addEventListener("click",()=>{this._designer.tableClick(d.tableDataCreator(this))})}_moveEvents(){let t,e;const i=i=>{i.stopPropagation();const n=this._designer.getMousePosRelativeContainer(i),o=n.x/this._designer.getZoom()+this._designer.getPan().x/this._designer.getZoom(),s=n.y/this._designer.getZoom()+this._designer.getPan().y/this._designer.getZoom(),a=o-t,h=s-e;this._elem.setAttributeNS(null,"x",a),this._elem.setAttributeNS(null,"y",h),this._pos.x=a,this._pos.y=h,this._onMove&&this._onMove(this,a,h)};this._elem.addEventListener("mousedown",n=>{n.stopPropagation(),this._table.classList.add("move");const o=this._table.getBoundingClientRect();t=(n.clientX-o.left)/this._designer.getZoom(),e=(n.clientY-o.top)/this._designer.getZoom(),document.addEventListener("mousemove",i),this._moveToTop()}),document.addEventListener("mouseup",()=>{this._table.classList.remove("move"),document.removeEventListener("mousemove",i)})}setName(t){this._name=t}getName(){return this._name}addColumn(t){this.columns.push(t)}setMoveListener(t){this._onMove=t}_normalizeX(t){return n(t/this._designer.getZoom()+this._designer.getPan().x)}_normalizeY(t){return n(t/this._designer.getZoom()+this._designer.getPan().y)}getCenter(){const t=this._designer.getCords(),e=this._table.getBoundingClientRect();return{x:this._normalizeX(e.left-t.x)+n(e.width/this._designer.getZoom())/2,y:this._normalizeY(e.top-t.y)+n(e.height/this._designer.getZoom())/2}}getSides(){const t=this._designer.getCords(),e=this._table.getBoundingClientRect();return{right:{p1:{x:this._normalizeX(e.right-t.x),y:this._normalizeY(e.top-t.y)},p2:{x:this._normalizeX(e.right-t.x),y:this._normalizeY(e.bottom-t.y)}},left:{p1:{x:this._normalizeX(e.left-t.x),y:this._normalizeY(e.top-t.y)},p2:{x:this._normalizeX(e.left-t.x),y:this._normalizeY(e.bottom-t.y)}},top:{p1:{x:this._normalizeX(e.left-t.x),y:this._normalizeY(e.top-t.y)},p2:{x:this._normalizeX(e.right-t.x),y:this._normalizeY(e.top-t.y)}},bottom:{p1:{x:this._normalizeX(e.left-t.x),y:this._normalizeY(e.bottom-t.y)},p2:{x:this._normalizeX(e.right-t.x),y:this._normalizeY(e.bottom-t.y)}}}}render(){this._elem=document.createElementNS(s.nsSvg,"foreignObject"),this._elem.setAttributeNS(null,"x",this._pos.x),this._elem.setAttributeNS(null,"y",this._pos.y),setTimeout(()=>{let t=parseInt(getComputedStyle(this._table).borderWidth,10);t=isNaN(t)?0:t,this._elem.setAttributeNS(null,"width",this._table.scrollWidth+t),this._elem.setAttributeNS(null,"height",this._table.scrollHeight+t)}),this._table=document.createElementNS(s.nsHtml,"table"),this._table.className="table";const t=document.createElementNS(s.nsHtml,"tr");this._table.appendChild(t);const e=document.createElementNS(s.nsHtml,"th");return e.setAttributeNS(null,"colspan",2),e.innerHTML=this._name,t.appendChild(e),this._elem.appendChild(this._table),this.columns.forEach(t=>{const e=document.createElementNS(s.nsHtml,"tr");t.elem=e,this._table.appendChild(e);const i=document.createElementNS(s.nsHtml,"td");i.innerHTML=t.name,e.appendChild(i);const n=document.createElementNS(s.nsHtml,"td");t.fk?n.innerHTML=t.fk.column.type:n.innerHTML=t.type,e.appendChild(n)}),this._clickEvents(),this._moveEvents(),this._elem}static tableDataCreator(t){return{name:t._name,pos:t._pos}}setDesigner(t){this._designer=t}getElement(){return this._elem}highlightFrom(t){t.elem.classList.add("fromRelation")}removeHighlightFrom(t){t.elem.classList.remove("fromRelation")}highlightTo(t){t.elem.classList.add("toRelation")}removeHighlightTo(t){t.elem.classList.remove("toRelation")}}class _{constructor(t){this.mainElem=t,this._container=this.mainElem.getElementById("designer-container"),this._svgElem=this.mainElem.getElementById("designer"),this._minimap=this.mainElem.getElementById("minimap"),this._viewpoint=this.mainElem.getElementById("viewpoint"),this._btnZoomIn=this.mainElem.getElementById("btn-zoom-in"),this._btnZoomOut=this.mainElem.getElementById("btn-zoom-out"),this._svgContainer=this.mainElem.querySelector(".svg-container"),this._reset(),this._setUpEvents()}_reset(){this._zoom=1,this._viewBoxVals={minX:0,minY:0,width:this._svgContainer.clientWidth,height:this._svgContainer.clientHeight},this._svgElem.style.height=s.DESIGNER_PAN_HEIGHT+"px",this._svgElem.style.width=s.DESIGNER_PAN_WIDTH+"px",this._svgElem.setAttribute("viewBox",`0 0 ${s.DESIGNER_PAN_WIDTH} ${s.DESIGNER_PAN_HEIGHT}`),this._tableMinimap=new Map,this._relationInfos=[],this._minimap.setAttribute("viewBox",`0 0 ${s.DESIGNER_PAN_WIDTH} ${s.DESIGNER_PAN_HEIGHT}`),this._minimap.querySelectorAll(".mini_table").forEach(t=>t.remove()),this._setViewPoint()}load(t){this._relationInfos=[],this._svgElem.innerHTML="",this.tables=t,t.forEach(t=>{t.setDesigner(this),t.setMoveListener(this.onTableMove.bind(this))}),this._reset(),this.draw()}onTableMove(t,e,i){this._drawRelations(),this._tableMinimap.get(t).setAttributeNS(null,"transform",`translate(${e},${i})`),this._tableMoveCallback&&this._tableMoveCallback(d.tableDataCreator(t))}_drawRelations(){this.tables.forEach(t=>{const e=this._getTableRelations(t),i=e.filter(t=>t.calcPathTableSides()),n=e.filter(e=>(e.toTable===t&&e.toTablePathSide===s.PATH_LEFT||e.fromTable===t&&e.fromTablePathSide===s.PATH_LEFT)&&!e.sameTableRelation()),o=e.filter(e=>(e.toTable===t&&e.toTablePathSide===s.PATH_RIGHT||e.fromTable===t&&e.fromTablePathSide===s.PATH_RIGHT)&&!e.sameTableRelation()),a=e.filter(e=>(e.toTable===t&&e.toTablePathSide===s.PATH_TOP||e.fromTable===t&&e.fromTablePathSide===s.PATH_TOP)&&!e.sameTableRelation()),h=e.filter(e=>(e.toTable===t&&e.toTablePathSide===s.PATH_BOTTOM||e.fromTable===t&&e.fromTablePathSide===s.PATH_BOTTOM)&&!e.sameTableRelation());c.ySort(n,t),c.ySort(o,t),c.xSort(a,t),c.xSort(h,t);const r=[{side:"left",order:1,count:n.length},{side:"right",order:2,count:o.length},{side:"top",order:3,count:a.length},{side:"bottom",order:4,count:h.length}];i.forEach(t=>{const e=r.sort((t,e)=>{const i=t.count-e.count;return 0===i?t.order-e.order:i})[0];switch(e.side){case"left":n.push(t),t.fromTablePathSide=s.PATH_LEFT,t.toTablePathSide=s.PATH_LEFT;break;case"right":o.push(t),t.fromTablePathSide=s.PATH_RIGHT,t.toTablePathSide=s.PATH_RIGHT;break;case"top":a.push(t),t.fromTablePathSide=s.PATH_TOP,t.toTablePathSide=s.PATH_TOP;break;case"bottom":h.push(t),t.fromTablePathSide=s.PATH_BOTTOM,t.toTablePathSide=s.PATH_BOTTOM}e.count+=2});let l=0;n.forEach(e=>{const i=r.find(t=>"left"===t.side).count;e.fromTable!==e.toTable?(e.fromTable===t?(e.fromPathIndex=l,e.fromPathCount=i):(e.toPathIndex=l,e.toPathCount=i),l++):(e.fromPathCount=i,e.toPathCount=i,e.fromPathIndex=l,e.toPathIndex=l+1,l+=2)}),l=0,o.forEach(e=>{const i=r.find(t=>"right"===t.side).count;e.fromTable!==e.toTable?(e.fromTable===t?(e.fromPathIndex=l,e.fromPathCount=i):(e.toPathIndex=l,e.toPathCount=i),l++):(e.fromPathCount=i,e.toPathCount=i,e.fromPathIndex=l,e.toPathIndex=l+1,l+=2)}),l=0,a.forEach(e=>{const i=r.find(t=>"top"===t.side).count;e.fromTable!==e.toTable?(e.fromTable===t?(e.fromPathIndex=l,e.fromPathCount=i):(e.toPathIndex=l,e.toPathCount=i),l++):(e.fromPathCount=i,e.toPathCount=i,e.fromPathIndex=l,e.toPathIndex=l+1,l+=2)}),l=0,h.forEach(e=>{const i=r.find(t=>"bottom"===t.side).count;e.fromTable!==e.toTable?(e.fromTable===t?(e.fromPathIndex=l,e.fromPathCount=i):(e.toPathIndex=l,e.toPathCount=i),l++):(e.fromPathCount=i,e.toPathCount=i,e.fromPathIndex=l,e.toPathIndex=l+1,l+=2)})}),this._relationInfos.forEach(t=>{t.removeHoverEffect(),t.getElems().forEach(t=>this._svgElem.removeChild(t)),t.render().forEach(t=>this._svgElem.prepend(t))})}draw(){let t=Number.MAX_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;this._tableMinimap=new Map,this.tables.forEach((o,a)=>{const h=o.render();h.setAttribute("id",a+"table"),this._svgElem.appendChild(h);const r=o.getSides(),l=document.createElementNS(s.nsSvg,"rect");l.setAttributeNS(null,"class","mini_table"),l.setAttributeNS(null,"transform",`translate(${r.left.p1.x}, ${r.left.p1.y})`),l.setAttributeNS(null,"width",r.top.p2.x-r.top.p1.x),l.setAttributeNS(null,"height",r.left.p2.y-r.left.p1.y),this._tableMinimap.set(o,l),this._minimap.appendChild(l),o.columns.forEach(t=>{if(t.fk){let e={fromTable:o,toTable:t.fk.table,fromColumn:t,toColumn:t.fk.column};e=new c(e),this._relationInfos.push(e)}});const m=o.getSides().right.p1.x;m>e&&(e=m);const d=o.getSides().left.p1.x;d<t&&(t=d);const _=o.getSides().top.p1.y;_<i&&(i=_);const g=o.getSides().bottom.p1.y;g>n&&(n=g)}),setTimeout(()=>{this._drawRelations()}),setTimeout(()=>{this.tables.forEach(t=>t.postDraw&&t.postDraw())})}_getTableRelations(t){return this._relationInfos.filter(e=>e.fromTable===t||e.toTable===t)}_setViewPoint(){this._viewpoint.setAttributeNS(null,"x",this._viewBoxVals.minX),this._viewpoint.setAttributeNS(null,"y",this._viewBoxVals.minY),this._viewpoint.setAttributeNS(null,"width",this._viewBoxVals.width),this._viewpoint.setAttributeNS(null,"height",this._viewBoxVals.height)}getCords(){const t=this._svgElem.getBoundingClientRect();return{x:t.left+this._svgContainer.scrollLeft*this._zoom,y:t.top+this._svgContainer.scrollTop*this._zoom}}_viewportAddjustment(){const t=this._viewBoxVals.width+this._viewBoxVals.minX-s.DESIGNER_PAN_WIDTH;t>0&&(this._viewBoxVals.minX-=t,this._viewBoxVals.minX<0&&(this._viewBoxVals.minX=0));const e=this._viewBoxVals.height+this._viewBoxVals.minY-s.DESIGNER_PAN_HEIGHT;e>0&&(this._viewBoxVals.minY-=e,this._viewBoxVals.minY<0&&(this._viewBoxVals.minY=0))}_windowResizeEvent(){this._viewBoxVals.width=this._svgContainer.clientWidth/this._zoom,this._viewBoxVals.height=this._svgContainer.clientHeight/this._zoom,this._viewportAddjustment(),this._setViewPoint()}_setUpEvents(){let t,e;window.addEventListener("resize",this._windowResizeEvent.bind(this));const i=i=>{const n=(i.clientX-t)/this._zoom,o=(i.clientY-e)/this._zoom;e=i.clientY,t=i.clientX,this._svgContainer.scrollLeft-n+this._svgContainer.clientWidth/this._zoom<s.DESIGNER_PAN_WIDTH&&this._svgContainer.scrollLeft-n>=0&&(this._viewBoxVals.minX-=n,this._svgContainer.scrollLeft-=n),this._svgContainer.scrollTop-o+this._svgContainer.clientHeight/this._zoom<s.DESIGNER_PAN_HEIGHT&&this._svgContainer.scrollTop-o>=0&&(this._viewBoxVals.minY-=o,this._svgContainer.scrollTop-=o),this._setViewPoint()};this._container.addEventListener("mouseleave",()=>{this._svgElem.classList.remove("pan"),this.mainElem.removeEventListener("mousemove",i)}),this._container.addEventListener("mousedown",n=>{this._svgElem.classList.add("pan"),t=n.clientX,e=n.clientY,this.mainElem.addEventListener("mousemove",i)}),this.mainElem.addEventListener("mouseup",()=>{this._svgElem.classList.remove("pan"),this.mainElem.removeEventListener("mousemove",i)}),this._btnZoomIn.addEventListener("click",()=>{this._zoom*=1.2,this._svgElem.style.height=s.DESIGNER_PAN_HEIGHT*this._zoom+"px",this._svgElem.style.width=s.DESIGNER_PAN_WIDTH*this._zoom+"px",this._viewBoxVals.width=this._svgContainer.clientWidth/this._zoom,this._viewBoxVals.height=this._svgContainer.clientHeight/this._zoom,this._setViewPoint()}),this._btnZoomOut.addEventListener("click",()=>{1.2*this._viewBoxVals.height<=s.DESIGNER_PAN_HEIGHT&&1.2*this._viewBoxVals.width<=s.DESIGNER_PAN_WIDTH&&(this._viewportAddjustment(),this._zoom/=1.2,this._svgElem.style.height=s.DESIGNER_PAN_HEIGHT*this._zoom+"px",this._svgElem.style.width=s.DESIGNER_PAN_WIDTH*this._zoom+"px",this._viewBoxVals.width=this._svgContainer.clientWidth/this._zoom,this._viewBoxVals.height=this._svgContainer.clientHeight/this._zoom,this._setViewPoint())}),this.tables&&this.tables.forEach(t=>{t.setMoveListener(this.onTableMove.bind(this))}),this._svgContainer.addEventListener("scroll",t=>{this._viewBoxVals.minX=this._svgContainer.scrollLeft/this._zoom,this._viewBoxVals.minY=this._svgContainer.scrollTop/this._zoom,this._setViewPoint()})}getZoom(){return this._zoom}getPan(){return{x:this._svgContainer.scrollLeft,y:this._svgContainer.scrollTop}}getMousePosRelativeContainer(t){return{x:t.clientX-this._container.offsetLeft,y:t.clientY-this._container.offsetTop}}setTableDblClickCallback(t){this._tableDblClickCallback=t}setTableClickCallback(t){this._tableClickCallback=t}setTableMoveCallback(t){this._tableMoveCallback=t}tableDblClick(t){this._tableDblClickCallback&&this._tableDblClickCallback(t)}tableClick(t){this._tableClickCallback&&this._tableClickCallback(t)}}function g(t){const e=new Map,i=[];return t.tables.forEach(t=>{const n=t.columns.filter(t=>t.fk);e.set(t,n);for(let e=0;e<t.columns.length;)t.columns[e].fk?t.columns.splice(e,1):++e;i.push(new d(t))}),t.tables.forEach(t=>{e.get(t).forEach(e=>{const n=i.find(t=>t.getName()===e.fk.table),o=n.columns.find(t=>t.name===e.fk.column);i.find(e=>t.name===e.getName()).addColumn(Object.assign(e,{fk:{table:n,column:o}}))})}),i}var u=i(0),b=i.n(u),p=i(1),f=i.n(p),P=`\n<style>\n  ${b.a}\n</style>\n${f.a}\n`;customElements.define("db-designer",class extends HTMLElement{constructor(){super();const t=this.attachShadow({mode:"open"});t.innerHTML=P,this.designer=new _(t),this.designer.setTableDblClickCallback(this.onTableDblClick.bind(this)),this.designer.setTableClickCallback(this.onTableClick.bind(this)),this.designer.setTableMoveCallback(this.onTableMove.bind(this))}onTableDblClick(t){this.dispatchEvent(new CustomEvent("tableDblClick",{detail:t}))}onTableClick(t){this.dispatchEvent(new CustomEvent("tableClick",{detail:t}))}onTableMove(t){this.dispatchEvent(new CustomEvent("tableMove",{detail:t}))}set src(t){this.setAttribute("src",t)}static get observedAttributes(){return["src"]}attributeChangedCallback(t,e,i){this._src=i,fetch(this._src).then(t=>t.json()).then(t=>{const e=g(t);this.designer.load(e)})}set schema(t){const e=g(t);this.designer.load(e)}})}])}]);
//# sourceMappingURL=main.js.map